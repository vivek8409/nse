/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2019, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 6.5.2
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/Products/barcode-recognition-javascript.aspx
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var n=0;return function(){return n<q.length?{done:!1,value:q[n++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.makeIterator=function(q){var n="undefined"!=typeof Symbol&&Symbol.iterator&&q[Symbol.iterator];return n?n.call(q):$jscomp.arrayIterator(q)};
(function(q,n){"undefined"!=typeof self&&self.document&&(self.__dbrWasmCurrentScript__=document.currentScript.src.substring(0,document.currentScript.src.lastIndexOf("/")),self.__dbrLicenseKey__=document.currentScript.getAttribute("data-licenseKey"),self.__dbrRuntimeLicenseKey__=document.currentScript.getAttribute("data-runtimeLicenseKey"));"function"===typeof define&&(define.amd||define.cmd)?define(n):"object"===typeof module&&module.exports?module.exports=n():(n=n(),q.dynamsoft=q.dynamsoft||{},q.dynamsoft.BarcodeReader=
n,q.BarcodeReader=q.BarcodeReader||n,q.dbr=q.dbr||n)})(this,function(){var q=function(){var a=function(){this._queue=[];this.isWorking=!1;this.timeout=100};a.prototype.push=function(a,d,h){this._queue.push({task:a,context:d,args:h});this.isWorking||this.next()};a.prototype.unshift=function(a,d,h){this._queue.unshift({task:a,context:d,args:h});this.isWorking||this.next()};a.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var a=this._queue.shift(),d=a.task,
h=a.context?a.context:null,f=a.args?a.args:[];setTimeout(function(){d.apply(h,f)},this.timeout)}};return a}(),n,v;if("undefined"!=typeof self){var u=self;self.document?n=!0:v=!0}else{u=global;var t=!0}var a=function(){var a=u,b=function(a){a=a||b.licenseKey||"";if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'Constructor BarcodeReader(licenseKey)': Type of 'licenseKey' should be 'String'.");this._licenseKey=a;if(!b.isLoaded())throw Error("'Constructor BarcodeReader(licenseKey)': Autoload haven't start or you want to call `loadWasm` manually.");
if(!n){this._instance=new b._BarcodeReaderWasm(a);if(!this._instance)throw b.BarcodeReaderException(b.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.");!a&&b._runtimeLicenseResponse&&(this._runtimeLicenseKey=b.runtimeLicenseKey,this._instance.InitSettingsFromServer(JSON.stringify({key:b.runtimeLicenseKey,licenseinfo:b._runtimeLicenseResponse.licenseinfo,units:b._runtimeLicenseResponse.units})))}};b._jsVersion="6.5.2";b._jsEditVersion="20190606";b.version="loading...(JS "+b._jsVersion+
"."+b._jsEditVersion+")";b.isLoaded=function(){return"loaded"==this._loadWasmStatus};b._dbName="dynamsoft-dbr-wasm-"+b._jsVersion;b._DB=void 0;b._licenseUrl="https://www.keillion.site/other/license.txt";b.licenseKey=a.__dbrLicenseKey__;b.runtimeLicenseKey=a.__dbrRuntimeLicenseKey__;b._runtimeLicenseResponse=void 0;var m=n?a.__dbrWasmCurrentScript__?__dbrWasmCurrentScript__:__dbrESMCurrentScript__:void 0;b._resourcesPath=m;b._workerName=void 0;b._wasmjsName=void 0;b._wasmName=void 0;b._workerResourcePath=
void 0;b._wasmjsResourcePath=void 0;b._wasmResourcePath=void 0;b._isShowRelDecodeTimeInResults=!1;b._bCustomWorker=void 0;b._bWithio=void 0;b._onWasmDownloaded=void 0;b._bLoadWorkerDirectlyFromUrl=void 0;b._onLog=void 0;b._canvasMaxWH=4096;b._bUseIndexDB=!0;b._bDebuggerInWorker=!1;b.createInstance=function(a){return b.loadWasm().then(function(){var c=new b(a);return n?c._createWorkerInstance():Promise.resolve(c)})};var h={};b._loadWorker=function(){return new Promise(function(a,g){var c=b._workerName||
"dbr-"+b._jsVersion+".min.js";if(b._workerResourcePath||b._resourcesPath){var e=b._workerResourcePath||b._resourcesPath;"/"!=e.charAt(e.length-1)&&(e+="/");void 0===b._bLoadWorkerDirectlyFromUrl&&location&&location.origin&&0==b._resourcesPath.indexOf(location.origin)&&(b._bLoadWorkerDirectlyFromUrl=!0);c=e+c}Promise.resolve().then(function(){return b._bLoadWorkerDirectlyFromUrl?c:fetch(c).then(function(a){return a.blob()}).then(function(a){return URL.createObjectURL(a)})}).then(function(c){var e=
b._dbrWorker=new Worker(c);e.onerror=function(a){a="worker error, you should host the page in web service: "+a.message;b._onLog&&b._onLog(a);g(a)};e.onmessage=function(e){e=e.data;switch(e.type){case "log":b._onLog&&b._onLog(e.message);break;case "load":e.success?(b.version=e.version,b._defaultRuntimeSettings=e._defaultRuntimeSettings,b._onLog&&b._onLog("load dbr worker success"),a()):g(e.exception);b._bLoadWorkerDirectlyFromUrl||URL.revokeObjectURL(c);break;case "task":try{h[e.id](e.body),h[e.id]=
void 0}catch(w){throw h[e.id]=void 0,w;}break;default:b._onLog&&b._onLog(e)}};var r=document.createElement("a");r.href=b._resourcesPath||"./";var k=void 0;b._wasmjsResourcePath&&(k=document.createElement("a"),k.href=b._wasmjsResourcePath||"./",k=k.href);var f=void 0;b._wasmResourcePath&&(f=document.createElement("a"),f.href=b._wasmResourcePath||"./",f=f.href);e.postMessage({type:"loadWorker",_licenseUrl:b._licenseUrl,runtimeLicenseKey:b.runtimeLicenseKey,_resourcesPath:r.href,_wasmjsResourcePath:k,
_wasmResourcePath:f,_bUseIndexDB:b._bUseIndexDB,_bDebuggerInWorker:b._bDebuggerInWorker,origin:location.origin})}).catch(function(a){g(a)})})};b.prototype._createWorkerInstance=function(){var a=this;return new Promise(function(c,k){var g=Math.random();h[g]=function(g){return g.success?g.instanceID?(a._instanceID=g.instanceID,c(a)):k(b.BarcodeReaderException(b.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.")):k(g.exception)};b._dbrWorker.postMessage({type:"createInstance",id:g,
licenseKey:a._licenseKey})})};b.prototype.deleteInstance=function(){var a=this;if(this._instance)this._instance.delete();else if(this._instanceID)return new Promise(function(c,k){var g=Math.random();h[g]=function(a){return a.success?c():k(a.exception)};b._dbrWorker.postMessage({type:"deleteInstance",id:g,instanceID:a._instanceID})})};b.prototype._decodeBlob=function(c,b){var g=this;if(!(a.Blob&&c instanceof Blob))return Promise.reject("'_decodeBlob(blob, templateName)': Type of 'blob' should be 'Blob'.");
b=b||"";return n?(new Promise(function(a,b){var g=URL.createObjectURL(c),e=new Image;e.dbrObjUrl=g;e.src=g;e.onload=function(){a(e)};e.onerror=function(){b(TypeError("'_decodeBlob(blob, templateName)': Can't convert the blob to image."))}})).then(function(a){return g._decodeImage(a)}):(new Promise(function(a){var b=new FileReader;b.onload=function(){a(b.result)};b.readAsArrayBuffer(c)})).then(function(a){return g._decodeArrayBuffer(a,b)})};b.prototype._decodeArrayBuffer=function(c,b){if(!(a.arrayBuffer&&
c instanceof ArrayBuffer||a.Buffer&&c instanceof Buffer))return Promise.reject("'_decodeBlob(arrayBuffer, templateName)': Type of 'arrayBuffer' should be 'ArrayBuffer' or 'Buffer'.");b=b||"";return n?this._decodeBlob(new Blob(c),b):this._decodeUint8Array(new Uint8Array(c))};b.prototype._decodeUint8Array=function(c,g){var k=this;if(!(a.Uint8Array&&c instanceof Uint8Array||a.Uint8ClampedArray&&c instanceof Uint8ClampedArray))return Promise.reject("'_decodeBlob(uint8Array, templateName)': Type of 'uint8Array' should be 'Uint8Array'.");
g=g||"";return n?k._decodeBlob(new Blob(c),g):new Promise(function(a){if(b._isShowRelDecodeTimeInResults){var e=(new Date).getTime(),l=k._instance.DecodeFileInMemory(c,g);e=(new Date).getTime()-e;l=f(l);l._decodeTime=e;return a(l)}return a(f(k._instance.DecodeFileInMemory(c,g)))})};b.prototype._decodeImage=function(c,b){var g=this;return(new Promise(function(g){if(!(a.HTMLImageElement&&c instanceof HTMLImageElement))throw TypeError("'_decodeImage(image, templateName)': Type of 'image' should be 'HTMLImageElement'.");
if(c.crossOrigin&&"anonymous"!=c.crossOrigin)throw"cors";b=b||"";g()})).then(function(){var a=document.createElement("canvas"),k=Math.max(c.naturalWidth,c.naturalHeight);if(4096<k){var l=4096/k;k=Math.round(c.naturalWidth*l);l=Math.round(c.naturalHeight*l)}else k=c.naturalWidth,l=c.naturalHeight;a.width=k;a.height=l;a.getContext("2d").drawImage(c,0,0,k,a.height);c.dbrObjUrl&&URL.revokeObjectURL(c.dbrObjUrl);return g._decodeCanvas(a,b)})};b.prototype._decodeCanvas=function(c,g){var k=this;return(new Promise(function(b){if(!(a.HTMLCanvasElement&&
c instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, templateName)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(c.crossOrigin&&"anonymous"!=c.crossOrigin)throw"cors";g=g||"";var e=c.getContext("2d").getImageData(0,0,c.width,c.height).data;b(e)})).then(function(a){return k._decodeRawImageUint8Array(a,c.width,c.height,4*c.width,b.EnumImagePixelFormat.IPF_ARGB_8888,g)})};b.prototype._decodeVideo=b.prototype.decodeVideo=function(c){var b=this,k,e=arguments,f,l;return(new Promise(function(g){if(!(a.HTMLVideoElement&&
c instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [ [, sx, sy, sWidth, sHeight], dWidth, dHeight] [, templateName] )': Type of 'video' should be 'HTMLVideoElement'.");if(c.crossOrigin&&"anonymous"!=c.crossOrigin)throw"cors";var h,r,d;if(2>=e.length){var m=h=0;var x=r=c.videoWidth;var n=d=c.videoHeight}else 4>=e.length?(m=h=0,x=c.videoWidth,n=c.videoHeight,r=e[1],d=e[2]):(m=e[1],h=e[2],x=e[3],n=e[4],r=e[5],d=e[6]);k="string"==typeof e[e.length-1]?e[e.length-1]:"";l=document.createElement("canvas");
l.width=r;l.height=d;var q=l.getContext("2d");b._bAddOriVideoCanvasToResult&&(f=document.createElement("canvas"),f.width=c.videoWidth,f.height=c.videoHeight,f.getContext("2d").drawImage(c,0,0));q.drawImage(f||c,m,h,x,n,0,0,r,d);g()})).then(function(){return b._decodeCanvas(l,k)}).then(function(a){if(b._bAddOriVideoCanvasToResult)for(var c=$jscomp.makeIterator(a),g=c.next();!g.done;g=c.next())g.value.oriVideoCanvas=f;if(b._bAddSearchRegionCanvasToResult)for(c=$jscomp.makeIterator(a),g=c.next();!g.done;g=
c.next())g.value.searchRegionCanvas=l;return a})};b.prototype._decodeBase64=b.prototype.decodeBase64String=function(a,b){var c=this;if(!("string"==typeof a||"object"==typeof a&&a instanceof String))return Promise.reject("'decodeBase64(base64Str, templateName)': Type of 'base64Str' should be 'String'.");"data:image/"==a.substring(0,11)&&(a=a.substring(a.indexOf(",")+1));b=b||"";return new Promise(function(g){if(t)g(c._decodeArrayBuffer(Buffer.from(a,"base64"),b));else{for(var e=atob(a),k=e.length,
f=new Uint8Array(k);k--;)f[k]=e.charCodeAt(k);n?g(c._decodeBlob(new Blob([f]),b)):g(c._decodeUint8Array(f,b))}})};b.prototype._decodeUrl=function(a,b){var c=this;return new Promise(function(g,f){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'url' should be 'String'.");b=b||"";if(t)(a.startsWith("https")?require("https"):require("http")).get(a,function(a){if(200==a.statusCode){var e=[];a.on("data",function(a){e.push(a)}).on("end",
function(){g(c._decodeArrayBuffer(Buffer.concat(e),b))})}else f("http get fail, statusCode: "+a.statusCode)});else{var e=new XMLHttpRequest;e.open("GET",a,!0);e.responseType=n?"blob":"arraybuffer";e.send();e.onloadend=function(){n?g(c._decodeBlob(this.response,b)):g(c._decodeArrayBuffer(this.response,b))};e.onerror=function(){f(e.error)}}})};b.prototype._decodeFilePath=function(a,b){var c=this;return new Promise(function(g,f){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeFilePath(path, templateName)': Type of 'path' should be 'String'.");
b=b||"";require("fs").readFile(a,function(a,e){a?f(a):g(c._decodeArrayBuffer(e,b))})})};b.prototype._decodeRawImageBlob=function(c,b,f,e,h,l){var g=this;return(new Promise(function(b,g){if(!(a.Blob&&c instanceof Blob))throw TypeError("'_decodeRawImageBlob(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'Blob'.");l=l||"";var e=new FileReader;e.readAsArrayBuffer(c);e.onload=function(){b(e.result)};e.onerror=function(){g(e.error)}})).then(function(a){return g._decodeRawImageUint8Array(new Uint8Array(a),
b,f,e,h,l)})};b.prototype._decodeRawImageArrayBuffer=function(c,b,f,e,h,l){var g=this;return(new Promise(function(b){if(!(a.ArrayBuffer&&c instanceof ArrayBuffer))throw TypeError("'_decodeRawImageArrayBuffer(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'ArrayBuffer'.");l=l||"";b()})).then(function(){return g._decodeRawImageUint8Array(new Uint8Array(c),b,f,e,h,l)})};b.prototype._decodeRawImageUint8Array=function(c,g,k,e,d,l){var m=this;return(new Promise(function(b){if(!(a.Uint8Array&&
c instanceof Uint8Array||a.Uint8ClampedArray&&c instanceof Uint8ClampedArray))throw TypeError("'_decodeRawImageUint8Array(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'Uint8Array'.");l=l||"";m._localizationResultArray=void 0;b()})).then(function(){if(m._instance){if(b._isShowRelDecodeTimeInResults){var a=(new Date).getTime(),r=m._instance.DecodeBuffer(c,g,k,e,d,l);a=(new Date).getTime()-a;r=f(r);r._decodeTime=a;return Promise.resolve(r)}try{r=m._instance.DecodeBuffer(c,
g,k,e,d,l)}catch(w){return setTimeout(function(){console.error("wasm error!");throw w;},0),Promise.reject(w)}return Promise.resolve(f(r))}var x;r=m._instanceID?Promise.resolve():m._createWorkerInstance();return r.then(function(){return null===m._runtimeSettings?new Promise(function(a,c){var g=Math.random();h[g]=function(b){return b.success?(m._runtimeSettings=void 0,a()):c(b.exception)};b._dbrWorker.postMessage({type:"resetRuntimeSettings",id:g,instanceID:m._instanceID})}):Promise.resolve()}).then(function(){return new Promise(function(a,
f){var r=Math.random();h[r]=function(c){return c.success?a(c.results):f(c.exception)};b._dbrWorker.postMessage({type:"decodeRawImageUint8Array",id:r,instanceID:m._instanceID,body:{buffer:c,width:g,height:k,stride:e,enumImagePixelFormat:d,templateName:l},_isShowRelDecodeTimeInResults:b._isShowRelDecodeTimeInResults})})}).then(function(a){x=a;return new Promise(function(a,c){var g=Math.random();h[g]=function(b){return b.success?a(b.results):c(b.exception)};b._dbrWorker.postMessage({type:"getAllLocalizationResults",
id:g,instanceID:m._instanceID})})}).then(function(a){m._localizationResultArray=a;return Promise.resolve(x)})})};b.prototype.decode=b.prototype.decodeFileInMemory=function(c,b){return a.Blob&&c instanceof Blob?this._decodeBlob(c,b):a.ArrayBuffer&&c instanceof ArrayBuffer||a.Buffer&&c instanceof Buffer?this._decodeArrayBuffer(c,b):a.Uint8Array&&c instanceof Uint8Array||a.Uint8ClampedArray&&c instanceof Uint8ClampedArray?this._decodeUint8Array(c,b):a.HTMLImageElement&&c instanceof HTMLImageElement?
this._decodeImage(c,b):a.HTMLCanvasElement&&c instanceof HTMLCanvasElement?this._decodeCanvas(c,b):a.HTMLVideoElement&&c instanceof HTMLVideoElement?this._decodeVideo(c,b):"string"==typeof c||c instanceof String?"data:image/"==c.substring(0,11)?this._decodeBase64(c,b):t?"http"==c.substring(0,4)?this._decodeUrl(c,b):this._decodeFilePath(c,b):this._decodeUrl(c,b):Promise.reject(TypeError("'_decode(source, templateName)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))};
b.prototype._decodeRawImage=b.prototype.decodeBuffer=function(c,b,f,e,h,l){return a.Blob&&c instanceof Blob?this._decodeRawImageBlob(c,b,f,e,h,l):a.ArrayBuffer&&c instanceof ArrayBuffer?this._decodeRawImageArrayBuffer(c,b,f,e,h,l):a.Uint8Array&&c instanceof Uint8Array||a.Uint8ClampedArray&&c instanceof Uint8ClampedArray?this._decodeRawImageUint8Array(c,b,f,e,h,l):Promise.reject(TypeError("'_decodeRawImage(source, width, height, stride, enumImagePixelFormat, templateName)': Type of 'source' should be 'Blob', 'ArrayBuffer' or 'Uint8Array'."))};
var f=b._handleRetJsonString=function(a){a="string"==typeof a||"object"==typeof a&&a instanceof String?JSON.parse(a):a;var c=b.EnumErrorCode;switch(a.exception){case c.DBR_SUCCESS:case c.DBR_LICENSE_INVALID:case c.DBR_LICENSE_EXPIRED:case c.DBR_1D_LICENSE_INVALID:case c.DBR_QR_LICENSE_INVALID:case c.DBR_PDF417_LICENSE_INVALID:case c.DBR_DATAMATRIX_LICENSE_INVALID:case c.DBR_DBRERR_AZTEC_LICENSE_INVALID:case c.DBR_RECOGNITION_TIMEOUT:if(a.textResult)for(c=0;c<a.textResult.length;++c){var f=a.textResult[c];
try{f.BarcodeText=t?Buffer.from(f.BarcodeText,"base64").toString():atob(f.BarcodeText)}catch(e){f.BarcodeText=""}}return a.textResult||a.localizationResultArray||a.Result||a.templateSettings||a.settings||a.outputSettings||a;default:throw b.BarcodeReaderException(a.exception,a.description);}};b.prototype.getAllLocalizationResults=function(){return this._localizationResultArray?this._localizationResultArray:f(this._instance.GetAllLocalizationResults())};b.prototype.getAllParameterTemplateNames=function(){return f(this._instance.GetAllParameterTemplateNames())};
b.prototype.getRuntimeSettings=function(){return this._instance?f(this._instance.GetRuntimeSettings()):this._runtimeSettings?JSON.parse(this._runtimeSettings):JSON.parse(b._defaultRuntimeSettings)};b.prototype.updateRuntimeSettings=function(a){var c=this;if("string"==typeof a||"object"==typeof a&&a instanceof String)var k=a;else if("object"==typeof a)k=JSON.stringify(a);else throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");if(c._instance)try{return f(c._instance.UpdateRuntimeSettings(k)),
Promise.resolve()}catch(e){return Promise.reject(e)}else return Promise.resolve().then(function(){return c._instanceID?Promise.resolve():c._createWorkerInstance()}).then(function(){return new Promise(function(a,g){var e=Math.random();h[e]=function(b){return b.success?(c._runtimeSettings=k,a()):g(b.exception)};b._dbrWorker.postMessage({type:"updateRuntimeSettings",id:e,instanceID:c._instanceID,body:{settings:k}})})}).catch(function(a){return Promise.reject(a)})};b.prototype.resetRuntimeSettings=function(){this._instance?
f(this._instance.ResetRuntimeSettings()):this._runtimeSettings=null};b.prototype.outputSettingsToString=function(a){return f(this._instance.OutputSettingsToString(a||""))};b.prototype.initRuntimeSettingsWithString=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'initRuntimeSettingstWithString(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");f(this._instance.InitRuntimeSettingstWithString(a,
b?b:2))};b.prototype.appendTplStringToRuntimeSettings=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'appendTplStringToRuntimeSettings(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");f(this._instance.AppendTplStringToRuntimeSettings(a,b?b:2))};b.EnumBarcodeFormat={All:503317503,OneD:1023,CODE_39:1,CODE_128:2,CODE_93:4,CODABAR:8,ITF:16,EAN_13:32,EAN_8:64,UPC_A:128,
UPC_E:256,INDUSTRIAL_25:512,PDF417:33554432,QR_CODE:67108864,DATAMATRIX:134217728,AZTEC:268435456};b.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1E4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,
DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,
DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_DBRERR_AZTEC_LICENSE_INVALID:-10041};b.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9};b.EnumResultType={EDT_StandardText:0,EDT_RawText:1,EDT_CandidateText:2,
EDT_PartialText:3};b.EnumTerminateStage={ETS_Prelocalized:0,ETS_Localized:1,ETS_Recognized:2};b.EnumConflictMode={ECM_Ignore:1,ECM_Overwrite:2};b.BarcodeReaderException=function(){return function(a,g){var c=b.EnumErrorCode.DBR_UNKNOWN;"number"==typeof a?(c=a,a=Error(g)):a=Error(a);a.code=c;return a}}();return b}();!v||a._bCustomWorker||u.onmessage||function(){var d=u;a._onLog=a._onLog||function(b){if(d.onmessage!=a._onWorkerMessage)a._onLog=void 0;else{var h=void 0;if(void 0===b)h="undefined";else{try{h=
JSON.stringify(b,function(){var a=[],b=[];return function(c,f){if("object"===typeof f&&null!==f){var e=a.indexOf(f);if(-1!==e)return"[Circular "+b[e]+"]";a.push(f);b.push(c||"root")}return f}}())}catch(f){}if(void 0===h||"{}"===h)h=b.toString()}try{postMessage({type:"log",message:h})}catch(f){d.console&&console.error(message)}}};a._onLog("have detected in worker: "+a.version);var b={};d.onmessage=a._onWorkerMessage=function(d){d=d.data;switch(d.type){case "loadWorker":(function(){a._licenseUrl=d._licenseUrl;
a.runtimeLicenseKey=d.runtimeLicenseKey;a._resourcesPath=d._resourcesPath;a._wasmjsResourcePath=d._wasmjsResourcePath;a._wasmResourcePath=d._wasmResourcePath;a._bUseIndexDB=d._bUseIndexDB;if(d._bDebuggerInWorker)debugger;a.loadWasm().then(function(){postMessage({type:"load",success:!0,version:a.version,_defaultRuntimeSettings:a._defaultRuntimeSettings})},function(a){postMessage({type:"load",success:!1,exception:a.message||a})})})();break;case "createInstance":(function(){try{var h=Math.random();b[h]=
new a(d.licenseKey);postMessage({type:"task",id:d.id,body:{success:!0,instanceID:h}})}catch(f){postMessage({type:"task",id:d.id,body:{success:!1,exception:f.message||f}})}})();break;case "deleteInstance":try{b[d.instanceID].deleteInstance(),b[d.instanceID]=void 0,postMessage({type:"task",id:d.id,body:{success:!0}})}catch(h){postMessage({type:"task",id:d.id,body:{success:!1,exception:h.message||h}})}break;case "decodeRawImageUint8Array":(function(){try{a._isShowRelDecodeTimeInResults=d._isShowRelDecodeTimeInResults;
var h=d.body;b[d.instanceID]._decodeRawImageUint8Array(h.buffer,h.width,h.height,h.stride,h.enumImagePixelFormat,h.templateName).then(function(a){postMessage({type:"task",id:d.id,body:{success:!0,results:a}})}).catch(function(a){postMessage({type:"task",id:d.id,body:{success:!1,exception:a.message||a}})})}catch(f){postMessage({type:"task",id:d.id,body:{success:!1,exception:f.message||f}})}})();break;case "getAllLocalizationResults":(function(){try{var a=b[d.instanceID].getAllLocalizationResults();
postMessage({type:"task",id:d.id,body:{success:!0,results:a}})}catch(f){postMessage({type:"task",id:d.id,body:{success:!1,exception:f.message||f}})}})();break;case "getRuntimeSettings":(function(){try{var a=b[d.instanceID].getRuntimeSettings();postMessage({type:"task",id:d.id,body:{success:!0,settings:a}})}catch(f){postMessage({type:"task",id:d.id,body:{success:!1,exception:f.message||f}})}})();break;case "updateRuntimeSettings":try{b[d.instanceID].updateRuntimeSettings(d.body.settings),postMessage({type:"task",
id:d.id,body:{success:!0}})}catch(h){postMessage({type:"task",id:d.id,body:{success:!1,exception:h.message||h}})}break;case "resetRuntimeSettings":try{b[d.instanceID].resetRuntimeSettings(),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(h){postMessage({type:"task",id:d.id,body:{success:!1,exception:h.message||h}})}break;default:postMessage({type:"task",id:d.id,body:{success:!1,exception:"No such task."}})}}}();(function(){var d=u;a.loadWasm=function(){return new Promise(function(f,c){if("loaded"==
a._loadWasmStatus)return f();a._loadWasmTaskQueue.push(function(g){if("loaded"==a._loadWasmStatus)return a._loadWasmTaskQueue.next(),f();if(g)return a._loadWasmTaskQueue.next(),c(a._loadWasmStatus);a._loadWasmStatus="loading";return(new Promise(function(c,e){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm hasn't finish loading.");};if(!d.WebAssembly||"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&
/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))throw Error("'Constructor BarcodeReader(licenseKey)': The browser doesn't support Webassembly.");if(n)return a._loadWorker().then(function(){return c()},function(b){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm load failed. ex: "+(b.message||b));};return e(b)});var g={locateFile:function(){var b=a._wasmName;if(a._wasmResourcePath||a._resourcesPath){var c=a._wasmResourcePath||a._resourcesPath;"/"!=c.charAt(c.length-
1)&&(c+="/");b=c+b}else t&&(b=require("path").join(__dirname,b));return b},onRuntimeInitialized:function(){a._BarcodeReaderWasm=g.BarcodeReaderWasm;var b=new g.BarcodeReaderWasm("");a.version=b.GetVersion()+"(JS "+a._jsVersion+"."+a._jsEditVersion+")";a._defaultRuntimeSettings=JSON.stringify(a._handleRetJsonString(b.GetRuntimeSettings()));b.delete();a._onLog&&a._onLog("load dbr wasm success, version: "+a.version);t?c():m.then(function(){c()},function(a){e(a)})}};g.onExit=g.onAbort=function(b){a._onLog&&
a._onLog(b);a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm load failed. Error: "+(b.message||b));};e(b)};g.print=function(b){a._onLog&&a._onLog(b)};if("undefined"==typeof _dbrLoadWasm){void 0==a._bWithio&&(a._bWithio=t||v&&(a._bCustomWorker||d.onmessage!=a._onWorkerMessage));a._wasmjsName=a._wasmjsName||"dbr-"+a._jsVersion+".wasm"+(a._bWithio?".withio":"")+".min.js";a._wasmName=a._wasmName||"dbr-"+a._jsVersion+(a._bWithio?".withio":"")+".wasm";var f=
a._wasmjsName;if(a._wasmjsResourcePath||a._resourcesPath){var h=a._wasmjsResourcePath||a._resourcesPath;"/"!=h.charAt(h.length-1)&&(h+="/");f=h+f}else t&&(f=require("path").join(__dirname,f));v?importScripts(f):_dbrLoadWasm=require(f)}_dbrLoadWasm(g,b,a)})).then(function(){a._loadWasmStatus="loaded";a._loadWasmTaskQueue.next();f()}).catch(function(b){a._loadWasmStatus=b;a._loadWasmTaskQueue.next();c(b)})},null,["loading"==a._loadWasmStatus])})};a._loadWasmTaskQueue=function(){var a=new q;a.timeout=
0;return a}();a._openDb=function(){var a=this;return new Promise(function(b,g){var c=function(){d.result.createObjectStore("info");d.result.createObjectStore("wasm");d.result.createObjectStore("license");d.result.createObjectStore("consume")},e="open db ["+a._dbName+"] fail",d=indexedDB.open(a._dbName,1);d.onupgradeneeded=c;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){var f=d.error.message||d.error;-1!=f.indexOf("version")?(d=indexedDB.deleteDatabase(a._dbName),d.onsuccess=
function(){var d=indexedDB.open(a._dbName,1);d.onupgradeneeded=c;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){g(e)}},d.onerror=function(){g(e)}):g(e+": "+f)}})};a._lookupInDatabase=function(a,b,d){return new Promise(function(c,e){var g=a.transaction([b]).objectStore(b),f=d?g.get(d):g.getAll();f.onsuccess=function(){f.result?c(f.result):e(d+" was not found in "+b)}})};a._storeInDatabase=function(a,b,d,h){return new Promise(function(c,g){var e=a.transaction([b],"readwrite").objectStore(b).put(h,
d);e.onerror=function(){g("Failed to store "+d+" in indexDB: "+(e.error.message||e.error))};e.onsuccess=function(){c("Successfully stored "+d+" in "+b)}})};var b=function(b,c,d){a._onLog&&a._onLog("start handle dbr wasm, version: "+b);var f=(new Date).getTime();if(t)return new Promise(function(b,e){require("fs").readFile(c,function(c,g){if(c)return e(c);var h=(new Date).getTime();b(WebAssembly.instantiate(g,d).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-
h));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)}))})});var e=function(a){return new Promise(function(b,c){var d=a.transaction(["info"]).objectStore("info").get("bSupportStoreModuleInDb"),e=function(){var d=a.transaction(["info"],"readwrite").objectStore("info"),e=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,127,3,2,1,0,7,6,1,2,95,97,0,0,10,6,1,4,0,65,1,11]);try{var f=d.put(new WebAssembly.Module(e.buffer),"testStoreModule");
f.onsuccess=function(){d.put(!0,"bSupportStoreModuleInDb").onsuccess=function(){b("set bSupportStoreModuleInDb = true success")}};f.onerror=function(){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(f.error.message||f.error))}}catch(y){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(y.message||y))}};d.onsuccess=function(){d.result?b("bSupportStoreModuleInDb == true"):e()}})};return(a._bUseIndexDB?a._openDb():Promise.reject("bUseIndexDB false")).then(function(b){a._onLog&&
a._onLog("open db success");m=h();return e(b).then(function(b){a._onLog&&a._onLog(b);return Promise.resolve(!0)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.resolve(!1)}).then(function(e){var g=(new Date).getTime();return a._lookupInDatabase(b,"wasm",a._wasmName).then(function(c){if(c instanceof WebAssembly.Module){a._onLog&&a._onLog("get a wasm module from db, timecost:"+((new Date).getTime()-g));var h=(new Date).getTime();return WebAssembly.instantiate(c,d).then(function(b){a._onLog&&
a._onLog("build instance from module timecost: "+((new Date).getTime()-h));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve({module:c,instance:b})})}a._onLog&&a._onLog("get a wasm binary from db, timecost:"+((new Date).getTime()-g));var k=(new Date).getTime();return WebAssembly.instantiate(c,d).then(function(c){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-k));if(e){var d=(new Date).getTime();return a._storeInDatabase(b,
"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(c)})}a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(c)})},function(g){a._onLog&&a._onLog(g.message||g);a._onLog&&a._onLog("downloading...");var h=(new Date).getTime();return e?WebAssembly.instantiateStreaming(fetch(c),
d).then(function(c){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("download with build timecost: "+((new Date).getTime()-h));var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}):
fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(c){a._onLog&&a._onLog("download timecost: "+((new Date).getTime()-h));a._onWasmDownloaded&&a._onWasmDownloaded();var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}).then(function(b){var c=
(new Date).getTime();return WebAssembly.instantiate(b,d).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-c));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)})})})})},function(b){a._onLog&&a._onLog(b.message||b);m=h();return WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch(c),d).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+
((new Date).getTime()-f));return Promise.resolve(b)}):fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();return WebAssembly.instantiate(b,d).then(function(b){a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)})})})},m,h=function(){var b=a.runtimeLicenseKey,c=(new Date).getTime();if(!b||!/^[0-9a-z]{7,20}$/.test(b))return Promise.resolve(!1);
var d=null,h=!1;return a._lookupInDatabase(a._DB,"license",b).then(function(a){d=a;h=d["next-expire-time"]<c},function(){h=!0}).then(function(){a._onLog&&a._onLog("licenseResponseFromDB:");a._onLog&&a._onLog(d);a._onLog&&a._onLog("bNeedGetFromServer: "+h);return h?fetch(a._licenseUrl+"?key="+b+"&version=1").then(function(a){if(a.ok)return a.json();throw Error("Network Error: fetch licenseinfo.");}).then(function(d){a._onLog&&a._onLog("licenseResponseFromServer:");a._onLog&&a._onLog(d);if("ok"==d.status)return a._runtimeLicenseResponse=
d,d["next-expire-time"]=c+1E3*d["min-expire-during"],d["max-expire-time"]=c+1E3*d["max-expire-during"],a._storeInDatabase(a._DB,"license",b,d).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});if("error"==d.status)throw Error(d.message);if("exceeded"==d.status)throw Error("Authorized Scan Count Reached");throw Error("Unknow Response: fetch licenseinfo");}).catch(function(e){a._onLog&&a._onLog(e.message||e);if(d&&d["max-expire-time"]>c)return d["next-expire-time"]=c+
1E3*d["check-interval-after-expire"],a._runtimeLicenseResponse=d,a._storeInDatabase(a._DB,"license",b,d).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});throw Error("Can't get valid licenseinfo from runtimekey.");}).then(function(){}):a._runtimeLicenseResponse=d})};a.clearCache=function(){return new Promise(function(b,c){try{var d=window.indexedDB.deleteDatabase(a._dbName);d.onsuccess=d.onerror=function(){d.error?c("Clear failed: "+(d.error.message||d.error)):b()}}catch(k){c(k)}})};
u._dbrConsume=function(b){a._onLog&&a._onLog(b);var c=0,d=a._runtimeLicenseResponse["post-urls"],f=function(){return fetch(d[c],{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",body:b}).then(function(a){if(!a.ok)throw Error("consume status: "+a.status);}).catch(function(e){a._onLog&&a._onLog(""+(e.message||e));++c<d.length?f():a._storeInDatabase(a._DB,"consume",Math.random().toString(),b).catch(function(b){a._onLog&&a._onLog(b)})})};f()}})();t||(a.Scanner=function(a){a=a||{};var b;(b=
a.htmlElement)||(b=document.createElement("div"),b.style.position="fixed",b.style.width="100%",b.style.height="100%",b.style.left="0",b.style.top="0",b.style.background="#eee",b.innerHTML='<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p><video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video><select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;"></select><select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;"></select><button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;"><svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button>');
this.htmlElement=b;this.videoSettings=a.videoSettings;this.confidence=a.confidence;void 0==this.confidence&&(this.confidence=30);this.intervalTime=a.intervalTime;void 0==this.intervalTime&&(this.intervalTime=100);this.runtimeSettings=a.runtimeSettings||{};this.searchRegion=a.searchRegion||{sx:void 0,sy:void 0,sWidth:void 0,sHeight:void 0,dWidth:void 0,dHeight:void 0};this.bAddOriVideoCanvasToResult=a.bAddOriVideoCanvasToResult;this.bAddSearchRegionCanvasToResult=a.bAddSearchRegionCanvasToResult;this.onFrameRead=
a.onFrameRead;this.duplicateForgetTime=a.duplicateForgetTime;void 0==this.duplicateForgetTime&&(this.duplicateForgetTime=3E3);this.onNewCodeRead=a.onNewCodeRead;this._isOpen=!1;this._barcodeReader=a.barcodeReader},a.Scanner.prototype.deleteInstance=function(){this._barcodeReader&&this._barcodeReader.deleteInstance()},a.Scanner.prototype.isOpen=function(){return this._isOpen},a.Scanner.prototype.open=function(){var d=this;if(!navigator.mediaDevices)return Promise.reject("`navigator.mediaDevices` is not available. Please ensure that you host the site in https.");
if(d._isOpen)return Promise.reject("The scanner is already open.");d._isOpen=!0;d.arrDiffCodeInfo=[];var b,m=d.htmlElement,h,f,c,g,k;(function(){for(var a=[m],b=$jscomp.makeIterator(m.children),d=b.next();!d.done;d=b.next())a.push(d.value);for(b=0;b<a.length;++b){var e=$jscomp.makeIterator(a[b].children);for(d=e.next();!d.done;d=e.next())a.push(d.value)}a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=a.next())d=d.value,d.classList.contains("dbrScanner-video")?h=d:d.classList.contains("dbrScanner-sel-camera")?
f=d:d.classList.contains("dbrScanner-sel-resolution")?(c=d,c.options.length||(c.innerHTML='<option class="dbrScanner-opt-gotResolution" value="got"></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="2560" data-height="1440">ask 2560 x 1440</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option>',
g=c.options[0])):d.classList.contains("dbrScanner-opt-gotResolution")?g=d:d.classList.contains("dbrScanner-btn-close")&&(k=d)})();var e=void 0,n=d._updateDevice=function(){return navigator.mediaDevices.enumerateDevices().then(function(a){var b=[],c;if(f){var d=f.value;f.innerHTML=""}for(var g=0;g<a.length;++g){var p=a[g];if("videoinput"==p.kind){var k={};k.deviceId=p.deviceId;k.label=p.label||"camera "+g;b.push(k)}}a=$jscomp.makeIterator(h.srcObject.getTracks());for(g=a.next();!g.done;g=a.next()){g=
g.value;if(l)break;if("video"==g.kind)for(p=$jscomp.makeIterator(b),k=p.next();!k.done;k=p.next())if(k=k.value,g.label==k.label){var l=k;e=k.deviceId;break}}if(f){a=$jscomp.makeIterator(b);for(k=a.next();!k.done;k=a.next())g=k.value,p=document.createElement("option"),p.value=g.deviceId,p.innerText=g.label,f.appendChild(p),d==g.deviceId&&(c=p);d=f.childNodes;if(!c&&l&&d.length)for(d=$jscomp.makeIterator(d),a=d.next();!a.done;a=d.next())if(a=a.value,l.label==a.innerText){c=a;break}c&&(f.value=c.value)}return Promise.resolve({current:l,
all:b})})};d._pausevideo=function(){h.pause()};var l=function(){h.srcObject&&(a._onLog&&a._onLog("======stop video========"),h.srcObject.getTracks().forEach(function(a){a.stop()}))},q=d._playvideo=function(b,f,k){return new Promise(function(C,m){l();a._onLog&&a._onLog("======before video========");var p=d.videoSettings=d.videoSettings||{video:{facingMode:{ideal:"environment"}}};/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=f?p.video.width=
1280:640<=f?p.video.width=640:320<=f&&(p.video.width=320):(f&&(p.video.width={ideal:f}),k&&(p.video.height={ideal:k}));b?(p.video.facingMode=void 0,p.video.deviceId={exact:b}):p.video.deviceId=p.video.deviceId||{ideal:e};var n=!1,B=function(){a._onLog&&a._onLog("======try getUserMedia========");a._onLog&&a._onLog("ask "+JSON.stringify(p.video.width)+"x"+JSON.stringify(p.video.height));navigator.mediaDevices.getUserMedia(p).then(function(b){a._onLog&&a._onLog("======get video========");return new Promise(function(d,
f){h.srcObject=b;h.onloadedmetadata=function(){a._onLog&&a._onLog("======play video========");h.play().then(function(){a._onLog&&a._onLog("======played video========");var b="got "+h.videoWidth+"x"+h.videoHeight;c&&g&&(g.setAttribute("data-width",h.videoWidth),g.setAttribute("data-height",h.videoHeight),c.value="got",g.innerText=b);a._onLog&&a._onLog(b);d();C({width:h.videoWidth,height:h.videoHeight})},function(a){f(a)})};h.onerror=function(){f()}})}).catch(function(b){a._onLog&&a._onLog(b);!n&&p.video?
(n=!0,p.video.deviceId=void 0,p.video.width=void 0,p.video.height=void 0,B()):m(b)})};B()})},t=function(a,b){if(a instanceof Array){var c=[];a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())c.push(t(d.value,b));return c}c=JSON.parse(JSON.stringify(a,function(a,b){if("oriVideoCanvas"!=a&&"searchRegionCanvas"!=a)return b}));b||(c.oriVideoCanvas=a.oriVideoCanvas,c.searchRegionCanvas=a.searchRegionCanvas);return c},u=function(){if(d._isOpen){if(h.paused)return a._onLog&&a._onLog("Video is paused. Ask in 1s."),
setTimeout(u,1E3);a._onLog&&a._onLog("======= once read =======");var c=(new Date).getTime();Promise.all([JSON.stringify(b.getRuntimeSettings())!=JSON.stringify(d.runtimeSettings)?b.updateRuntimeSettings(d.runtimeSettings):Promise.resolve(),function(){var a=d.searchRegion;if(a&&(a.sx||a.sy||a.sWidth||a.sHeight||a.dWidth||a.dHeight)){var b=a.sx||0,c=a.sy||0,f=a.sWidth||h.videoWidth,e=a.sHeight||h.videoHeight,g=a.dWidth||a.sWidth||h.videoWidth;a=a.dHeight||a.sHeight||h.videoHeight;0<b&&1>b&&(b=Math.round(b*
h.videoWidth));0<c&&1>c&&(c=Math.round(c*h.videoHeight));1>=f&&(f=Math.round(f*h.videoWidth));1>=e&&(e=Math.round(e*h.videoHeight));1>=g&&(g=Math.round(g*h.videoWidth));1>=a&&(a=Math.round(a*h.videoHeight));return[h,b,c,f,e,g,a]}return h}()]).then(function(a){a=a[1];a instanceof Array||(a=[a]);b._bAddOriVideoCanvasToResult=d.bAddOriVideoCanvasToResult;b._bAddSearchRegionCanvasToResult=d.bAddSearchRegionCanvasToResult;return b.decodeVideo.apply(b,a)}).then(function(b){var f=(new Date).getTime();a._onLog&&
a._onLog("time cost: "+(f-c)+"ms");for(var e=[],g=0;g<b.length;++g){var h=b[g],k=h.BarcodeText;a._onLog&&a._onLog(k);h.LocalizationResult.ExtendedResultArray[0].Confidence>=d.confidence&&e.push(h)}e=t(e);for(g=0;g<d.arrDiffCodeInfo.length;++g){h=d.arrDiffCodeInfo[g];k=-1;for(var l in e){var m=e[l];if(h.result.BarcodeText==m.BarcodeText&&h.result.BarcodeFormat==m.BarcodeFormat){k=l;break}}-1!=k?(h.time=f,h.result=e[k],++h.count,e.splice(k,1)):f-h.time>d.duplicateForgetTime&&(d.arrDiffCodeInfo.splice(g,
1),--g)}for(l=0;l<e.length;++l)for(g=e[l],h=l+1;h<e.length;)k=e[h],g.BarcodeText==k.BarcodeText&&g.BarcodeFormat==k.BarcodeFormat?e.splice(h,1):++h;g=$jscomp.makeIterator(e);for(l=g.next();!l.done;l=g.next())d.arrDiffCodeInfo.push({result:t(l.value,!0),time:f,count:1});if(d.onFrameRead)d.onFrameRead(t(b));b=$jscomp.makeIterator(e);for(l=b.next();!l.done;l=b.next())if(f=l.value,d.onNewCodeRead)d.onNewCodeRead(f.BarcodeText,t(f));setTimeout(u,d.intervalTime)}).catch(function(b){a._onLog&&a._onLog(b);
setTimeout(u,d.intervalTime);throw b;})}},v=function(){q(f.value).then(function(){d._isOpen||l()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};f&&f.addEventListener("change",v);var w=function(){if(c&&-1!=c.selectedIndex){var a=c.options[c.selectedIndex];var b=a.getAttribute("data-width");a=a.getAttribute("data-height")}q(void 0,b,a).then(function(){d._isOpen||l()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};c&&c.addEventListener("change",w);var z=!!m.parentNode,
y="none"===m.style.display,A=d._closeWindow=function(){l();d._isOpen=!1;f&&f.removeEventListener("change",v);c&&c.removeEventListener("change",w);d._closeWindow=void 0;k&&k.removeEventListener("click",A);var a=m.parentNode;a&&!z&&a.removeChild(m);y&&(m.style.display="none")};k&&k.addEventListener("click",A);z||document.body.appendChild(m);y&&(m.style.display="");return Promise.all([a.loadWasm(),q()]).then(function(c){if(!d._isOpen)return l(),Promise.resolve();b=d._barcodeReader=d._barcodeReader||
new a;var e=b.getRuntimeSettings();e.mAntiDamageLevel=3;e.mDeblurLevel=0;for(var f in d.runtimeSettings)void 0!=e[f]&&(e[f]=d.runtimeSettings[f]);d.runtimeSettings=e;return Promise.all([c[1],b.updateRuntimeSettings(e)])}).then(function(a){u();return Promise.all([a[0],n()])}).then(function(a){var b=a[0];a=a[1];return Promise.resolve({width:b.width,height:b.height,current:a.current,all:a.all})})},a.Scanner.prototype.play=function(a,b,m){return this._isOpen?this._playvideo(a,b,m):Promise.reject("The scanner is not open.")},
a.Scanner.prototype.pause=function(){this._isOpen&&this._pausevideo()},a.Scanner.prototype.close=function(){this._isOpen&&this._closeWindow()},a.Scanner.prototype.updateDevice=function(){return this._isOpen?this._updateDevice():navigator.mediaDevices.enumerateDevices().then(function(a){for(var b=[],d=0;d<a.length;++d){var h=a[d];if("videoinput"==h.kind){var f={};f.deviceId=h.deviceId;f.label=h.label||"camera "+d;b.push(f)}}return Promise.resolve({current:void 0,all:b})})});return a});
